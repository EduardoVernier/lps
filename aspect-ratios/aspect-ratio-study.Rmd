---
title: "Aspect Ratio Statistical Modelling"
output:
  html_document:
    highlight: pygments
---

We'd like to analyse the output of a given treemap technique. In this document we



First, set the working directory to be where this file is. In the IDE go to Session -> Set Working Directory -> To Source file Location.
Outside the IDE, do something like this `setwd("~/Desktop/lps/aspect-ratios")`.

List files containing the rectangles. 
Each files is a 'space' separated file containing *id x y width height* of every rectangle generated by the technique.
Merge all files in a single huge dataframe. (it takes a few seconds)
```{r}
library(dplyr)
library(magrittr)

rectangle_files = list.files("./sqr-rectangles", pattern = ".*.rect", recursive = TRUE, full.names = TRUE)
# There is too much data, let's sample
set.seed(42)
sample_size <- 20
rectangle_files_sample = sample(rectangle_files, sample_size, replace = FALSE)


# It was dumb not using comma separated values. Fix it tomorrow. For now ignore dataframes with more than 5 columns.
dataframes <- lapply(rectangle_files_sample, function(filename){
    df <- read.csv(filename, head = FALSE, sep = " ")
    if (ncol(df) == 5) {
      return(df)
    }
})

# Remove NULL items -- elements with ncol != 5
dataframes = dataframes[!sapply(dataframes, is.null)]
# Merge
df <- do.call(rbind, dataframes)
```

The only info we are actually interested in are the width and height of each rectangle.
More specifically, we are interested in the longest and shortest side of each rectangle
```{r}
df <- mutate(df, width = as.numeric(V4), height = as.numeric(V5))

df <- mutate(df, longest = pmax(width, height) , shortest = pmin(width, height)) %>%
  select(longest, shortest)
```

Now let's see the difference between the max/min vs the min/max ratios.
The standard in treemap papers is to use the former, but I think we'll see a behaviour close to the "break the stick" problem.
The second, which ranges between ]0,1] might have a better behaved distribution.
```{r}
library(ggplot2)
df %>%
  ggplot(aes(longest/shortest)) +
    geom_histogram()
```

```{r}
df %>%
  ggplot(aes(shortest/longest)) +
    geom_histogram()
```

Much nicer distribution.
```{r}
library(moments)
min_over_max = df$shortest/df$longest
summary(min_over_max)
sd(min_over_max)
kurtosis(min_over_max)
skewness(min_over_max)

max_over_min = df$shortest/df$longest
summary(max_over_min)
sd(max_over_min)
kurtosis(max_over_min)
skewness(max_over_min)

```






